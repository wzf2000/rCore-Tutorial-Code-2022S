# OS Lab4 实验报告

<h4>王哲凡 计93 2019011200</h4>

## 实现功能

- 类似合并 `ch5` 分支，其中 `spawn()` 接口需要添加对应的 `fd_table`。
- 通过在 `DiskInode` 中记录 `nlink` 数量来维护硬链接，并支持 `sys_fstat` 调用。
- 在 `unlinkat` 中，对 `nlink` 降到 $0$ 的类比 `clear()` 和 `dealloc_data()` 来回收数据。

## 问答题

### chapter 6

#### 第 1 题

root inode 是所有结点的根，也即 `/` 根目录。

在 easy-fs 中，所有的文件都直接位于 `/` 下。所有对于文件的查找、创建、链接、取消链接、列出（`ls`）都需要通过 `ROOT_INODE` 进行，而这又是通过在 `root_inode`（`DiskInode` 类型）中记录各个目录项 `DirEntry` 完成的。

如果 root inode 中的内容损坏，可能导致文件目录项出错，进而出现文件查找不到、文件查找错误、文件创建失败等相关问题。

### chapter 7

#### 第 1 题

可以利用管道来进行简单的文件统计，如 `cat *.rs | wc -l` 可以用来统计当前目录下，所有 Rust 文件的总代码行数。

同样类似的，可以使用 `cat *.rs | grep -n 'fn'` 这样的目录下文件查找。

#### 第 2 题

可以考虑额外设置一个通信进程 X，每一次进程通信前，假设进程 A 要给进程 B 一段信息 `TEXT`，则首先由 A 发送给 X 信息内容 `TEXT` 以及信息收方 B，再由 X 作为中转站，将信息 `TEXT` 发送给 B。

这样假设有 $n$ 个进程，则只需要每个进程分别与 X 建立读写各一个管道，共 $2n$ 个管道，而原方案需要每两个进程之间读写各一个管道，共 $n(n - 1)$ 个管道。

## 建议

对于 `sys_fstat` 调用的返回值没有明确给出，需要根据测例判断。
